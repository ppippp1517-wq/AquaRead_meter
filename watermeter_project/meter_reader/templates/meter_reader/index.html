{% extends "meter_reader/base.html" %}
{% block title %}Index{% endblock %}
{% block head %}
<style>
    :root { --brand:#1f3b73; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 16px; background: #f6f7fb; }
    .wrap { max-width: 960px; margin: 0 auto; }
    h2 { margin: 8px 0 16px; }
    .toolbar { display:flex; gap:12px; align-items:center; margin-bottom:12px; flex-wrap: wrap; }
    video, canvas { width: 100%; max-height: 60vh; background: #000; border-radius: 10px; }
    .row { display:grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 800px) { .row { grid-template-columns: 1fr 1fr; } }
    .card { background:#fff; padding:12px; border-radius:10px; box-shadow:0 2px 12px rgba(0,0,0,.06); }
    button { padding: 10px 14px; border-radius: 8px; border: 0; background: var(--brand); color: #fff; cursor: pointer; font-weight: 600; }
    button[disabled] { opacity: .55; cursor: not-allowed; }
    .muted { color:#6b7280; font-size: 12px; }
    .pill { display:inline-block; padding: 4px 8px; background:#eef2ff; color:var(--brand); border-radius: 999px; font-size: 12px; }
    a { color: var(--brand); }
</style>
{% endblock %}
{% block content %}
<!doctype html>
<div class="wrap">
  <h2>Meter Web <span class="pill">Camera → /api/analyze/</span></h2>

  <div class="toolbar">
    <button id="btnStart">Start Camera</button>
    <button id="btnShot" disabled>Capture & Analyze</button>
    <span id="status" class="muted"></span>
  </div>

  <div class="row">
    <div class="card">
      <h4>Camera Preview</h4>
      <video id="video" playsinline muted></video>
      <div class="muted">Tip: บน iPhone ถ้าเปิดกล้องไม่ได้ ให้ใช้ HTTPS (เช่น ngrok) หรือ localhost</div>
    </div>
    <div class="card">
      <h4>Result</h4>
      <canvas id="canvas"></canvas>
      <div style="margin-top:8px">Reading: <strong id="reading">-</strong></div>
      <div>Overlay: <a id="overlayLink" href="#" target="_blank">open</a></div>
    </div>
  </div>
</div>

{% endblock %}